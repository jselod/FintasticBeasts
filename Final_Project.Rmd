---
title: "Final Project"
author: "Michael Bevilacqua, Jonah Kotzen, Jaan Selod"
date: "2024-04-23"
output: html_document
bibliography: BIOL5380.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(av)
library(ggplot2)
```

# Introduction:


The  Myctophidae family includes the species *Diaphus mollis*, mesopelagic fish that reach body lengths of 6.6 cm [@Froese2024]. These myctopids are often called lantern fish, and can be found in Atlantic and Indian Oceans. have a high evolutionary radiation, with high variability in phenotypes. This has resulted in the Myctophidae being one of the most abundant and "most species-rich deep-sea fish groups" @Tuset2018there. In this study, we will be looking at the effect of Kármán vortices on several deceased Diaphus mollis, which vary in size. These vortices form after a constant flow of water hits an object in the water, which in a natural habitat could be a rock, or a tree, however in this circumstance, a wooden dowel is used. When the myctophid is placed in this street of vortices, fish "swimming behind cylinders adopt a distinctive, previously undescribed pattern of movement in order to hold station, which we term the Kármán gait" @Liao2003there. This study will look to analyze ...

![Diaphus mollis](https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Myctophum_punctatum1.jpg/640px-Myctophum_punctatum1.jpg)

metadata: specimen_speed.csv

# Methods:

- dead myctophids and water tunnel
- iPhone video recording software --> ImageJ with MTrackJ plugin --> coordinates

# Results:
```{r loadinfo, echo = F, warning = F, message = F}
specimens <- read.csv("specimen_info.csv")
specimens %>%
  kable(caption = "Table 1: Specimen Information")
```

```{r vidanalysis, eval = F}
#code used to generate avi files from iphone videos

f <- list.files(full.names = T, pattern = ".MOV")
dir.create("images")
for (i in f) {
  if(dir.exists("images")) unlink("images", recursive = T)
  av_video_images(i, destdir = "images", format = "tiff")
  f.i <- list.files("images", full.names = T)
  av_encode_video(f.i, gsub("MOV", "avi", basename(i)), codec = "rawvideo")
}
```

# XY Processing

```{r chunk1, include=TRUE}

# List all xy data files
file_list <- list.files(pattern = "_xy.csv")

# Read data and extract metadata from filenames
data_list <- lapply(file_list, function(file) {
  data <- read.csv(file)
  parts <- unlist(strsplit(file, "_"))
  species <- parts[1]
  flow <- gsub("xy.csv", "", parts[2])
  data <- mutate(data, Species = species, Flow = flow)
  return(data)
})

# Combine all data into one dataframe
combined_data <- bind_rows(data_list)

```

```{r chunk2, include=TRUE}
# Remove unnecessary columns and clean names
processed_data <- combined_data %>%
  select(-matches("I..val.|Len..mm.|D2S..mm.|D2R..mm.|D2P..mm.|v..mm.sec.|x..unit.|y..unit.|Len..unit.|D2S..unit.|D2R..unit.")) %>%
  rename(
    x = x..mm.,
    y = y..mm.,
    time = t..sec.,
    alpha = α..deg.,
    delta_alpha = Δα..deg.
  )

# Calculate distance between consecutive points
processed_data <- processed_data %>%
  group_by(Species, Flow) %>%
  arrange(Nr) %>%
  mutate(
    dx = x - lag(x),
    dy = y - lag(y),
    distance = sqrt(dx^2 + dy^2),
    cumulative_distance = cumsum(distance),
    speed = distance / (time - lag(time))
  ) %>%
  ungroup()

# Handle NA values generated by diff and lag
processed_data <- processed_data %>%
  filter(!is.na(distance))


```

# Stat Summary

```{r chunk3, include=TRUE}
# Statistical summary by Species and Flow
summary_stats <- processed_data %>%
  group_by(Species, Flow) %>%
  summarise(
    mean_alpha = mean(alpha, na.rm = TRUE),
    sd_alpha = sd(alpha, na.rm = TRUE)
  )

print(summary_stats)

```




# Graphs

```{r chunk4, include=TRUE}
# Plotting paths of different specimens
ggplot(processed_data, aes(x = x, y = y, color = as.factor(Species))) +
  geom_path() +
  facet_wrap(~ Flow) +
  labs(title = "Movement Paths by Species and Flow",
       x = "X Coordinate (mm)", y = "Y Coordinate (mm)",
       color = "Species") +
  theme_minimal()

```



# Discussion:

# Author Contributions:

# References:
